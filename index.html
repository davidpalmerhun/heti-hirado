<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Heti Híradó (Realtime)</title>
  <style>
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    .wrapper {
      max-width: 750px;
      margin: 0 auto;
      background: #fff;
      border-radius: 10px;
      padding: 25px 30px 30px 30px;
      box-shadow: 0 4px 22px 0 #0002;
    }
    h1 { text-align: center; margin-top: 0; }
    .note { background: #faf7f1; border-radius: 6px; padding: 14px 18px 12px 18px; margin: 16px 0; border: 1px solid #e0c997; position: relative;}
    .note-title { font-weight: bold; font-size: 1.12em; }
    .comments { margin-left: 25px; margin-top: 9px;}
    .comment { background: #eef0fa; border-radius: 6px; padding: 7px 13px; margin: 8px 0; font-size: 0.99em;}
    .small { font-size: 0.96em; color: #888; }
    .del-btn {
      background: transparent; border: none; color: #e33; font-weight: bold; font-size: 1.2em; cursor: pointer;
      position: absolute; top: 5px; right: 7px;
    }
    .del-btn:hover { color: #b00; }
    .add-row { display: flex; gap: 7px; margin: 12px 0 24px 0; }
    input, textarea, select {
      font-family: inherit;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 7px 8px;
    }
    textarea { resize: vertical; min-height: 55px; width: 100%; }
    .add-btn {
      background: #F4B731;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 1em;
    }
    .add-btn:hover { background: #e0a520; }
    .add-btn:active { background: #db9b0e; }
    .comment-form { margin-top: 12px; }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Heti Híradó <span style="font-size: 0.5em; color: #aaa">(Realtime)</span></h1>

    <div class="add-row">
      <input id="new-title" type="text" placeholder="Vázlatpont címe/pl. Szervező, Város, Projekt" style="flex:1;">
      <button class="add-btn" onclick="addNote()">+ Vázlatpont</button>
    </div>
    <textarea id="new-text" placeholder="Vázlatpont leírása" style="width:100%;margin-bottom:10px;"></textarea>

    <div id="notes-list"></div>
  </div>

  <!-- FIREBASE SDK SCRIPTS -->
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js"></script>
  <!-- FIREBASE INIT -->
  <script>
    // IDE MÁSOLD BE A SAJÁT firebaseConfig-odat!
    const firebaseConfig = {
      apiKey: "AIzaSyDn12dx4VO5COB2_eu7OCOusmT4z-NwdDA",
      authDomain: "heti-hirado.firebaseapp.com",
      projectId: "heti-hirado",
      storageBucket: "heti-hirado.appspot.com",
      messagingSenderId: "672469992573",
      appId: "1:672469992573:web:3c062fa37a4694c1c89d14",
      measurementId: "G-HRR8CCEJMT"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <!-- APP LOGIKA -->
  <script>
    const notesRef = db.collection("notes");

    // Új vázlatpont hozzáadása
    async function addNote() {
      const title = document.getElementById('new-title').value.trim();
      const text = document.getElementById('new-text').value.trim();
      if (!title && !text) return;
      await notesRef.add({
        title, text, comments: [], created: new Date().toISOString()
      });
      document.getElementById('new-title').value = '';
      document.getElementById('new-text').value = '';
    }

    // Vázlatpont törlése
    async function deleteNote(id) {
      await notesRef.doc(id).delete();
    }

    // Új komment hozzáadása
    async function addComment(noteId, nameInput, commentInput) {
      const name = nameInput.value.trim() || "Névtelen";
      const text = commentInput.value.trim();
      if (!text) return;
      const doc = await notesRef.doc(noteId).get();
      const old = doc.exists && doc.data().comments ? doc.data().comments : [];
      old.push({ name, text, created: new Date().toISOString() });
      await notesRef.doc(noteId).update({ comments: old });
      commentInput.value = "";
    }

    // Komment törlése
    async function deleteComment(noteId, idx) {
      const doc = await notesRef.doc(noteId).get();
      const old = doc.exists && doc.data().comments ? doc.data().comments : [];
      old.splice(idx, 1);
      await notesRef.doc(noteId).update({ comments: old });
    }

    // Valós idejű megjelenítés
    notesRef.orderBy("created").onSnapshot(snapshot => {
      const container = document.getElementById('notes-list');
      container.innerHTML = "";
      snapshot.forEach(doc => {
        const d = doc.data();
        const id = doc.id;
        // NOTE CARD
        const noteDiv = document.createElement('div');
        noteDiv.className = "note";
        noteDiv.innerHTML = `
          <button class="del-btn" onclick="deleteNote('${id}')">✕</button>
          <div class="note-title">${d.title || "<span class='small'>(Cím nélkül)</span>"}</div>
          <div style="margin:7px 0 2px 0">${d.text || ""}</div>
        `;
        // COMMENT THREAD
        const commentsDiv = document.createElement('div');
        commentsDiv.className = "comments";
        if (d.comments && d.comments.length) {
          d.comments.forEach((c, idx) => {
            const comm = document.createElement('div');
            comm.className = "comment";
            comm.innerHTML = `<b>${c.name}:</b> ${c.text}
              <button class="del-btn" title="Komment törlése" onclick="deleteComment('${id}',${idx})" style="position:static; float:right;">✕</button>`;
            commentsDiv.appendChild(comm);
          });
        }
        // ÚJ KOMMENT MEZŐ
        const form = document.createElement('div');
        form.className = "comment-form";
        form.innerHTML = `
          <select style="margin-bottom:5px;">
            <option>Ádám</option>
            <option>Dávid</option>
          </select>
          <textarea placeholder="Új komment..." style="margin-bottom:6px;"></textarea>
          <button class="add-btn" style="margin-top:3px;" onclick="addComment('${id}', this.previousElementSibling.previousElementSibling, this.previousElementSibling)">Kommentálom</button>
        `;
        commentsDiv.appendChild(form);

        noteDiv.appendChild(commentsDiv);
        container.appendChild(noteDiv);
      });
    });
  </script>
</body>
</html>
